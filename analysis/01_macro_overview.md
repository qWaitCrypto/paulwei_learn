# 宏观数据初步分析（bitmex_trades.csv）

本文件记录对根目录交易数据表 `bitmex_trades.csv` 的第一次宏观分析结果，用于后续更细致的回测、拆解和研究做参考基线。

## 数据概况

- 数据来源：BitMEX 成交与资金费执行记录。
- 行数：`171,547` 行。
- 时间范围：`2020-05-01 09:03:47+00:00` 至 `2025-11-24 04:00:00+00:00`，覆盖 5 年多交易历史。
- 主要字段：`timestamp, symbol, side, qty, price, execType, ordType, orderID, execID, homeNotional, foreignNotional, commission`。
- 时间戳格式不完全统一，使用 `pandas.to_datetime(..., format='mixed', utc=True)` 解析。

## 执行类型分布（execType）

- `Trade`：`159,321` 条 —— 实际成交记录。
- `Funding`：`12,207` 条 —— 资金费用记录。
- `Settlement`：`19` 条 —— 结算相关记录。

说明：  
资金费与结算记录可以用来衡量持仓跨 Funding 时点、长期持仓习惯以及资金费成本对整体收益的影响。

## 多空与交易频率

- 多空分布（只看 `Trade` 行）：  
  - `Sell`：`82,390`  
  - `Buy`：`76,950`  
  - （Funding 行 `side` 为 `NaN`，符合资金费不区分方向的特征）
- 交易日统计：  
  - 有交易的自然日数：`1,811` 天。  
  - 每个有交易日的平均成交笔数：约 `88` 笔。  

整体上看，这是持续多年、频率较高的主动交易记录，波段 + 高频混合的风格特征明显。

## 品种（symbol）分布

- 总共交易过的合约：`68` 个不同的 symbol（包含永续、季度、USDT 本位等）。  
- 所有记录中（含 Funding）：  
  - `XBTUSD`：`102,993` 行  
  - `ETHUSD`：`19,470` 行  
  - `LTCUSD`：`7,473` 行  
  - `XRPUSD`：`6,128` 行  
  - `DOGEUSD`：`5,924` 行  
- 只看 `Trade` 行时的主要品种：  
  - `XBTUSD`：`97,685` 笔 —— 样本中的绝对主力品种。  
  - `ETHUSD`：`17,896` 笔。  
  - `LTCUSD`：`6,595` 笔。  
  - `XRPUSD`：`5,497` 笔。  
  - `DOGEUSD`：`3,651` 笔。  
- 其它还包括：AAVE、ADA、TRX、UNI、YFI 等大量山寨币及季度/当季合约，单个合约的成交笔数多在几百到几千之间。

多数主流品种同时出现 `Trade` 和 `Funding` 记录，说明不仅做短线，也存在跨 Funding 点持仓的情况。

## 按年份的活跃度（Trade 笔数）

- 2020 年：`21,349` 笔（从 5 月开始，有“起步期”特征）。  
- 2021 年：`78,775` 笔 —— 全样本中最活跃的一年，接近“全职高频交易”。  
- 2022 年：`25,042` 笔。  
- 2023 年：`11,905` 笔。  
- 2024 年：`14,271` 笔。  
- 2025 年：`7,979` 笔（截至 2025-11-24）。  

可见 2021 年是交易密度和参与度的高峰期，此后总体频率有所下降，但仍保持长期持续交易。

## 按月份的节奏（Trade 笔数，节选）

- 早期阶段（2020）：  
  - 2020-05：`954`  
  - 2020-06：`1,444`  
  - 2020-07：`1,034`  
  - 2020-08：`1,366`  
  - 2020-09：`2,937`  
  - 2020-10：`5,415`  
  - 2020-11：`5,003`  
  - 2020-12：`3,196`  
- 高峰阶段（部分）：  
  - 2021-01：`19,921`  
  - 2021-02：`11,460`  
- 近期阶段（2025，节选）：  
  - 2025-02：`2,229`  
  - 2025-03：`1,024`  
  - 2025-04：`698`  
  - 2025-05：`453`  
  - 2025-06：`477`  
  - 2025-07：`149`  
  - 2025-08：`75`  
  - 2025-09：`119`  
  - 2025-10：`358`  
  - 2025-11：`385`  

可以看到，从 2020 下半年开始逐渐放量，2021 年初达到最密集的高频交易区间，之后频率逐步回落，但仍长期保持参与市场。

## 手数与仓位规模（示意）

这里只做一个定性说明，具体分布会在后续单独展开：

- 整体 Trade 行的 `qty`：  
  - 中位数约 `1,300` 合约，25% 分位约 `100`，75% 分位约 `10,000`。  
  - 存在极值（如某些 TRX 合约、LTCZ21 等出现 `1e10 ~ 1e13` 级别的 qty），需要进一步核实是否为撮合单位差异或异常数据，在严肃回测前要清洗。  
- 以 `XBTUSD` 为例：  
  - 中位单笔约 `4,800` 合约，75% 分位约 `16,300`，最大到数百万合约。  
  - 体现为：多数情况下是“中等仓位 + 高频切分”，辅以少数“放大仓位”的重仓操作。

## 手续费（commission）概览

- 所有记录的 `commission`：  
  - 计数：`171,547`。  
  - 均值约 `0.000316`。  
  - 典型区间：`[-0.0001, 0.00075]`，极值约在 `-0.0057` 至 `0.0075` 之间。  
- Funding 记录的 commission 为负值或极小值，代表资金费支出或收入；Trade 行大多体现为开平仓手续费。

## 小结与后续方向

当前阶段我们对 `bitmex_trades.csv` 做了**纯宏观层面**的认识：

- 明确了时间范围、总笔数、多空比例和交易频率。  
- 梳理了主力品种（尤其是 XBTUSD、ETHUSD 等）及长尾品种数量。  
- 确认了 2021 年是交易最密集的高峰期，之后进入相对收敛阶段。  
- 初步观察了手数和手续费的量级，发现需要对极端数值做进一步清洗和解释。

## 品种精确列表（symbol universe）

从全部记录中提取出的 symbol 去重后，共计 `68` 个品种（包含永续、季度、当季、USDT 本位等），按字母排序如下：

`AAVEUSDT`, `ADAM20`, `ADAUSD`, `ADAUSDT`, `ALTMEXUSD`, `AXSUSDT`, `BCHH21`, `BCHUSD`,  
`BMEXUSD`, `BMEX_USDT`, `BNBUSD`, `BNBUSDT`, `DOGEUSD`, `DOGEUSDT`, `DOTUSDT`, `DOTUSDTH21`,  
`EOSH21`, `EOSUSDTZ20`, `ETHH21`, `ETHH22`, `ETHH23`, `ETHH24`, `ETHM20`, `ETHM21`, `ETHM22`,  
`ETHM23`, `ETHM24`, `ETHU20`, `ETHU21`, `ETHU22`, `ETHU23`, `ETHU24`, `ETHUSD`, `ETHUSDZ20`,  
`ETHZ20`, `ETHZ21`, `ETHZ22`, `ETHZ23`, `ETHZ24`, `LINKUSDT`, `LINKUSDTZ20`, `LTCH21`, `LTCM20`,  
`LTCM21`, `LTCU20`, `LTCU21`, `LTCUSD`, `LTCZ20`, `LTCZ21`, `LUNAUSD`, `ORDIUSD`, `TRXH21`,  
`TRXM20`, `TRXM21`, `TRXU20`, `TRXU21`, `TRXUSDT`, `TRXZ20`, `TRXZ21`, `UNIUSDT`, `XBTM21`,  
`XBTUSD`, `XBT_USDT`, `XLMUSDT`, `XRPUSD`, `XTZUSDTZ20`, `YFIUSDTH21`, `YFIUSDTZ20`。

其中部分 symbol 主要出现在 Trade 行，部分包含 Trade + Funding 行，后续在准备 K 线数据时可以按需选择重点品种（例如 XBTUSD、ETHUSD、LTCUSD、XRPUSD、DOGEUSD 等）。

## 交易节奏与最小 K 线级别的推断

以最核心品种 `XBTUSD` 为例，对全部 `97,685` 条 Trade 记录按时间排序并计算相邻成交时间间隔（单位：分钟），得到：

- 时间间隔分布概要：  
  - 中位数（50% 分位）：`0` 分钟（大量成交在同一分钟甚至同几秒内完成拆单）。  
  - 75% 分位：约 `0.006` 分钟，约合 `0.4` 秒。  
  - 95% 分位：约 `70` 分钟；99% 分位可达十几个小时。
- 相邻成交间隔小于某阈值的比例：  
  - ≤ `1` 分钟：约 `86%`。  
  - ≤ `5` 分钟：约 `89.5%`。  
  - ≤ `15` 分钟：约 `91.8%`。  
  - ≤ `60` 分钟：约 `94.7%`。

由此可以推断：

- 执行层面：  
  - 交易行为高度细粒度，存在大量“同分钟乃至同秒的拆单 / 加减仓”操作。  
  - 单纯依赖 1 小时或更长周期的 K 线，无法解释如此高密度的进出节奏。
- 决策层面（推断）：  
  - 很大概率会使用 5 分钟甚至 1 分钟级别的价格走势（或者直接盯盘口 / tick）来把握进出位置。  
  - 同时也可能在更高周期（15m / 1h 等）上确定方向和结构，再在低周期上精细执行。

因此，从“复盘与回放决策”的角度出发，本项目在准备行情数据时的基线假设是：

- **最小需要具备 5min K 线**，用于观察大部分重要的进出节奏与形态。  
- 考虑到他在 1 分钟内频繁拆单的特征，**建议统一拉取 1min K 线并向上聚合**：  
  - 统一使用 BitMEX 的 `1m` bucketed 数据作为底层时间序列；  
  - 在本地聚合出 `5m / 15m / 1h` 等不同级别，便于从不同尺度分析同一时刻的决策和执行。

后续在数据准备计划中，将以这 68 个 symbol 的“首次成交时间 ~ 最后成交时间”为基准窗口，规划需要拉取的 1min K 线区间。

后续可以在本目录下继续新增更细分的分析，例如：

- `02_equity_curve.md`：构建权益曲线、最大回撤、年化收益等。  
- `03_symbol_profile_XBTUSD.md`：针对单一品种（如 XBTUSD）的详细画像。  
- `04_hold_time_and_pnl.md`：持仓时间分布与盈亏关系分析等。  

本文件作为整个学习过程的“第一层地图”，后续所有更细致的分析都可以回到这里来对照整体节奏和结构。
